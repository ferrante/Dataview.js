(function(){var r=function(k,i){var l,m,n;if(k in i)return[i,k,k];else{l=k.split(".");m=i;n=l.pop();l.length&&l.map(function(p){m=m[p]});return[m,n,k]}},o=function(k){if(k===void 0||k===null)return"[object Falsy]";return Object.prototype.toString.call(k)},y=function(k){var i={},l={normal:false,strict:false},m=function(c,a,d){i[c]={update:[],remove:[],add:[],details:[a,d,c,o(a[d]),false]}},n=function(c){var a,d,f=[],e;if(typeof c!=="object")c=[c];a=0;for(d=c.length;a<d;a+=1){if(!(c[a]in i)){e=r(c[a],
k);m(e[1],e[0],e[2])}if(!i[c[a]].details[4])f[f.length]=i[c[a]].details}return f},p=function(c,a,d,f){var e=i[a][c];c=0;for(a=e.length;c<a;c+=1)(function(j,g,h,b){window.setTimeout(function(){j[g](h,b)},0)})(e,c,d,f)},s=function(c,a){for(var d in a)if(d in i)i[d][c]=i[d][c].concat(a[d])},q=function(c,a,d,f){var e,j,g=typeof d==="string"||typeof d==="number",h,b,u=f?"add":"update";e=0;for(j=c.length;e<j;e+=1){b=c[e];if(g){h=b[0][b[1]]&&d in b[0][b[1]];if(b[3]==="[object Array]")if(f&&h)b[0][b[1]].splice(d,
1,a);else if(h||f&&d>-1)b[0][b[1]][d]=a;else continue;else if(h||f&&b[3]==="[object Object]"){b[0][b[1]][d]=a;h||m(b[2]+"."+d,b[0][b[1]],d)}else if(b[3]==="[object Object]"&&!h){b=r(d,b[0][b[1]]);if(b[1]in b[0])b[0][b[1]]=a;else continue}else continue}else if(!f&&b[1]in b[0])b[0][b[1]]=a;else if(f&&b[3]==="[object Array]"){d=b[0][b[1]].length;b[0][b[1]].push(a)}else if(f&&!(b[1]in b[0]))b[0][b[1]]=a;b[3]=o(b[0][b[1]]);b[2]in i&&i[b[2]][u].length&&p(u,b[2],d,a)}},v=function(c,a){var d,f,e,j,g=a!==
void 0&&a!==null,h,b=false;d=0;for(f=c.length;d<f;d+=1){e=c[d];b=false;h=e[3]==="[object Array]";if(g)if(j=a in e[0][e[1]])if(h)e[0][e[1]].splice(a,1);else if(a in e[0][e[1]])delete e[0][e[1]][a];else continue;else if(typeof a==="string"){e=r(a,e[0][e[1]]);delete e[0][e[1]];b=true}else continue;else{delete e[0][e[1]];b=true}e[2]in i&&i[e[2]].remove.length&&p("remove",e[2],a);b&&delete i[e[2]]}},x=function(c,a,d){var f,e=c[d],j=c[d].__org||c[d];a=n(a);f={add:function(g,h){if(arguments.length===1){h=
g;g=void 0}q(a,h,g,"add")},remove:function(g){v(a,g)},update:function(g,h){if(arguments.length===1){h=g;g=void 0}q(a,h,g)}};if(!e.__proxied){e=function(){var g,h;g=0;for(h=e.__original.length;g<h;g+=1)e.__original[g].apply(f,arguments)};e.__proxied=true;e.__original=[];e.__org=j;c[d]=e}e.__original.push(function(){j.apply(f,arguments)})},w=function(c,a){var d,f=a||"";for(d in c)if(c.hasOwnProperty(d)){o(c[d])==="[object Object]"&&w(c[d],f+d+".");m(f+d,c,d)}return f},t=function(){if(l.strict)throw Error("Couldn't modify the property. Data object is freezed!");
};w(k);return{connect:function(c){var a;if(l.normal)throw Error("Couldn't connect a new view. Data object is freezed!");if(o(c)!=="[object Object]")throw Error("Couldn't connect a new view. Passed view is not an object!");return{on:function(d,f){var e=[].concat(f),j=o(d),g={},h={},b;a=d;if(j!=="[object Object]"){a=[].concat(a);b=0;for(j=a.length;b<j;b+=1)(h[a[b]]||(h[a[b]]=[])).push.apply(h[a[b]],e);a=h}if(typeof a==="object")for(b in a)if(a.hasOwnProperty(b)){if(b in i&&i[b].details[4])throw Error("Couldn't connect new methods. Locked property: "+
b);a[b]=[].concat(a[b]);j=0;for(e=a[b].length;j<e;j+=1)(g[a[b][j]]||(g[a[b][j]]=[])).push(b)}for(b in g)x(c,g[b],b);return this},lock:function(){for(var d in a)if(a.hasOwnProperty(d))i[d].details[4]=true}}},update:function(c,a,d){t();if(arguments.length===2){d=a;a=void 0}q(n(c),d,a)},remove:function(c,a){t();v(n(c),a)},add:function(c,a,d){t();if(arguments.length===2){d=a;a=void 0}q(n(c),d,a,"add")},onUpdate:function(c){s("update",c)},onRemove:function(c){s("remove",c)},onAdd:function(c){s("add",c)},
freeze:function(c){l.strict=!!c;l.normal=true},get:function(c){if(arguments.length===0)return k;else if(c in i){var a=i[c].details;return a[0][a[1]]}}}};this.dataview=function(k){return y(k)};this.dataview.version="0.8"})();